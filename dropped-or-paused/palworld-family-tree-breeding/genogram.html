<!DOCTYPE html>
<html lang="en">

<body>
  <script src="https://unpkg.com/gojs@2.3.13/release/go.js"></script>
  <p>
    This is a minimalist HTML and JavaScript skeleton of the GoJS Sample
    <a href="https://gojs.net/latest/samples/genogram.html">genogram.html</a>. It was automatically generated from a
    button on the sample page,
    and does not contain the full HTML. It is intended as a starting point to adapt for your own usage.
    For many samples, you may need to inspect the
    <a href="https://github.com/NorthwoodsSoftware/GoJS/blob/master/samples/genogram.html">full source on Github</a>
    and copy other files or scripts.
  </p>
  <div id="allSampleContent" class="p-4 w-full">
    <script id="code">
      // A custom layout that shows the two families related to a person's parents
      class GenogramLayout extends go.LayeredDigraphLayout {
        constructor() {
          super();
          this.alignOption = go.LayeredDigraphLayout.AlignAll;
          this.initializeOption = go.LayeredDigraphLayout.InitDepthFirstIn;
          this.spouseSpacing = 30;  // minimum space between spouses
          this.isRouting = false;
        }

        makeNetwork(coll) {
          // generate LayoutEdges for each parent-child Link
          const net = this.createNetwork();
          if (coll instanceof go.Diagram) {
            this.add(net, coll.nodes, true);
            this.add(net, coll.links, true);
          } else if (coll instanceof go.Group) {
            this.add(net, coll.memberParts, false);
          } else if (coll.iterator) {
            this.add(net, coll.iterator, false);
          }
          return net;
        }

        // internal method for creating LayeredDigraphNetwork where husband/wife pairs are represented
        // by a single LayeredDigraphVertex corresponding to the label Node on the marriage Link
        add(net, coll, nonmemberonly) {
          const horiz = this.direction == 0.0 || this.direction == 180.0;
          const multiSpousePeople = new go.Set();
          // consider all Nodes in the given collection
          const it = coll.iterator;
          while (it.next()) {
            const node = it.value;
            if (!(node instanceof go.Node) || !node.data) continue;
            if (!node.isLayoutPositioned || !node.isVisible()) continue;
            if (nonmemberonly && node.containingGroup !== null) continue;
            // if it's an unmarried Node, or if it's a Link Label Node, create a LayoutVertex for it
            if (node.isLinkLabel) {
              // get marriage Link
              const link = node.labeledLink;
              if (link.category === "Marriage") {
                const spouseA = link.fromNode;
                const spouseB = link.toNode;
                // create vertex representing both husband and wife
                const vertex = net.addNode(node);
                // now define the vertex size to be big enough to hold both spouses
                if (horiz) {
                  vertex.height = spouseA.actualBounds.height + this.spouseSpacing + spouseB.actualBounds.height;
                  vertex.width = Math.max(spouseA.actualBounds.width, spouseB.actualBounds.width);
                  vertex.focus = new go.Point(vertex.width / 2, spouseA.actualBounds.height + this.spouseSpacing / 2);
                } else {
                  vertex.width = spouseA.actualBounds.width + this.spouseSpacing + spouseB.actualBounds.width;
                  vertex.height = Math.max(spouseA.actualBounds.height, spouseB.actualBounds.height);
                  vertex.focus = new go.Point(spouseA.actualBounds.width + this.spouseSpacing / 2, vertex.height / 2);
                }
              }
            } else {
              // don't add a vertex for any married person!
              // instead, code above adds label node for marriage link
              // assume a marriage Link has a label Node
              let marriages = 0;
              node.linksConnected.each(l => {
                if (l.category === "Marriage") marriages++;
              });
              if (marriages === 0) {
                net.addNode(node);
              } else if (marriages > 1) {
                multiSpousePeople.add(node);
              }
            }
          }
          // now do all Links
          it.reset();
          while (it.next()) {
            const link = it.value;
            if (!(link instanceof go.Link)) continue;
            if (!link.isLayoutPositioned || !link.isVisible()) continue;
            if (nonmemberonly && link.containingGroup !== null) continue;
            // if it's a parent-child link, add a LayoutEdge for it
            if (link.category === "" && link.data) {
              const parent = net.findVertex(link.fromNode);  // should be a label node
              const child = net.findVertex(link.toNode);
              if (child !== null) {  // an unmarried child
                net.linkVertexes(parent, child, link);
              } else {  // a married child
                link.toNode.linksConnected.each(l => {
                  if (l.category !== "Marriage" || !l.data) return;  // if it has no label node, it's a parent-child link
                  // found the Marriage Link, now get its label Node
                  const mlab = l.labelNodes.first();
                  // parent-child link should connect with the label node,
                  // so the LayoutEdge should connect with the LayoutVertex representing the label node
                  const mlabvert = net.findVertex(mlab);
                  if (mlabvert !== null) {
                    net.linkVertexes(parent, mlabvert, link);
                  }
                });
              }
            }
          }

          while (multiSpousePeople.count > 0) {
            // find all collections of people that are indirectly married to each other
            const node = multiSpousePeople.first();
            const cohort = new go.Set();
            this.extendCohort(cohort, node);
            // then encourage them all to be the same generation by connecting them all with a common vertex
            const dummyvert = net.createVertex();
            net.addVertex(dummyvert);
            const marriages = new go.Set();
            cohort.each(n => {
              n.linksConnected.each(l => {
                marriages.add(l);
              })
            });
            marriages.each(link => {
              // find the vertex for the marriage link (i.e. for the label node)
              const mlab = link.labelNodes.first()
              const v = net.findVertex(mlab);
              if (v !== null) {
                net.linkVertexes(dummyvert, v, null);
              }
            });
            // done with these people, now see if there are any other multiple-married people
            multiSpousePeople.removeAll(cohort);
          }
        }

        // collect all of the people indirectly married with a person
        extendCohort(coll, node) {
          if (coll.has(node)) return;
          coll.add(node);
          node.linksConnected.each(l => {
            if (l.category === "Marriage") {  // if it's a marriage link, continue with both spouses
              this.extendCohort(coll, l.fromNode);
              this.extendCohort(coll, l.toNode);
            }
          });
        }

        assignLayers() {
          super.assignLayers();
          const horiz = this.direction == 0.0 || this.direction == 180.0;
          // for every vertex, record the maximum vertex width or height for the vertex's layer
          const maxsizes = [];
          this.network.vertexes.each(v => {
            const lay = v.layer;
            let max = maxsizes[lay];
            if (max === undefined) max = 0;
            const sz = (horiz ? v.width : v.height);
            if (sz > max) maxsizes[lay] = sz;
          });
          // now make sure every vertex has the maximum width or height according to which layer it is in,
          // and aligned on the left (if horizontal) or the top (if vertical)
          this.network.vertexes.each(v => {
            const lay = v.layer;
            const max = maxsizes[lay];
            if (horiz) {
              v.focus = new go.Point(0, v.height / 2);
              v.width = max;
            } else {
              v.focus = new go.Point(v.width / 2, 0);
              v.height = max;
            }
          });
          // from now on, the LayeredDigraphLayout will think that the Node is bigger than it really is
          // (other than the ones that are the widest or tallest in their respective layer).
        }

        initializeIndices() {
          super.initializeIndices();
          const vertical = this.direction === 90 || this.direction === 270;
          this.network.edges.each(e => {
            if (e.fromVertex.node && e.fromVertex.node.isLinkLabel) {
              e.portFromPos = vertical ? e.fromVertex.focusX : e.fromVertex.focusY;
            }
            if (e.toVertex.node && e.toVertex.node.isLinkLabel) {
              e.portToPos = vertical ? e.toVertex.focusX : e.toVertex.focusY;
            }
          })
        }

        commitNodes() {
          super.commitNodes();
          // position regular nodes
          this.network.vertexes.each(v => {
            if (v.node !== null && !v.node.isLinkLabel) {
              v.node.position = new go.Point(v.x, v.y);
            }
          });

          const horiz = this.direction == 0.0 || this.direction == 180.0;
          // position the spouses of each marriage vertex
          this.network.vertexes.each(v => {
            if (v.node === null) return;
            if (!v.node.isLinkLabel) return;
            const labnode = v.node;
            const lablink = labnode.labeledLink;
            // In case the spouses are not actually moved, we need to have the marriage link
            // position the label node, because LayoutVertex.commit() was called above on these vertexes.
            // Alternatively we could override LayoutVetex.commit to be a no-op for label node vertexes.
            lablink.invalidateRoute();
            let spouseA = lablink.fromNode;
            let spouseB = lablink.toNode;
            if (spouseA.opacity > 0 && spouseB.opacity > 0) {
              // prefer fathers on the left, mothers on the right
              if (spouseA.category === "F") {  // sex is female
                const temp = spouseA;
                spouseA = spouseB;
                spouseB = temp;
              }
              // see if the parents are on the desired sides, to avoid a link crossing
              const aParentsNode = this.findParentsMarriageLabelNode(spouseA);
              const bParentsNode = this.findParentsMarriageLabelNode(spouseB);
              if (aParentsNode !== null && bParentsNode !== null &&
                (horiz
                  ? aParentsNode.position.x > bParentsNode.position.x
                  : aParentsNode.position.y > bParentsNode.position.y)) {
                // swap the spouses
                const temp = spouseA;
                spouseA = spouseB;
                spouseB = temp;
              }
              spouseA.moveTo(v.x, v.y);
              if (horiz) {
                spouseB.moveTo(v.x, v.y + spouseA.actualBounds.height + this.spouseSpacing);
              } else {
                spouseB.moveTo(v.x + spouseA.actualBounds.width + this.spouseSpacing, v.y);
              }
            } else if (spouseA.opacity === 0) {
              const pos = horiz
                ? new go.Point(v.x, v.centerY - spouseB.actualBounds.height / 2)
                : new go.Point(v.centerX - spouseB.actualBounds.width / 2, v.y);
              spouseB.move(pos);
              if (horiz) pos.y++; else pos.x++;
              spouseA.move(pos);
            } else if (spouseB.opacity === 0) {
              const pos = horiz
                ? new go.Point(v.x, v.centerY - spouseA.actualBounds.height / 2)
                : new go.Point(v.centerX - spouseA.actualBounds.width / 2, v.y);
              spouseA.move(pos);
              if (horiz) pos.y++; else pos.x++;
              spouseB.move(pos);
            }
            lablink.ensureBounds();
          });
        }

        findParentsMarriageLabelNode(node) {
          const it = node.findNodesInto();
          while (it.next()) {
            const n = it.value;
            if (n.isLinkLabel) return n;
          }
          return null;
        }
      } // end GenogramLayout class


      function init() {

        // Since 2.2 you can also author concise templates with method chaining instead of GraphObject.make
        // For details, see https://gojs.net/latest/intro/buildingObjects.html
        const $ = go.GraphObject.make;

        myDiagram =
          new go.Diagram("myDiagramDiv",
            {
              "animationManager.isEnabled": false,
              initialAutoScale: go.Diagram.Uniform,
              "undoManager.isEnabled": true,
              maxSelectionCount: 1,
              // when a node is selected, draw a big yellow circle behind it
              nodeSelectionAdornmentTemplate:
                $(go.Adornment, "Auto",
                  { layerName: "Grid" },  // the predefined layer that is behind everything else
                  $(go.Shape, "Circle", { fill: "#c1cee3", stroke: null }),
                  $(go.Placeholder, { margin: 2 })
                ),
              layout:  // use a custom layout, defined above
                $(GenogramLayout, { direction: 90, layerSpacing: 30, columnSpacing: 10 })
            });

        // determine the color for each attribute shape
        function attrFill(a) {
          switch (a) {
            case "A": return "#00af54"; // green
            case "B": return "#f27935"; // orange
            case "C": return "#d4071c"; // red
            case "D": return "#70bdc2"; // cyan
            case "E": return "#fcf384"; // gold
            case "F": return "#e69aaf"; // pink
            case "G": return "#08488f"; // blue
            case "H": return "#866310"; // brown
            case "I": return "#9270c2"; // purple
            case "J": return "#a3cf62"; // chartreuse
            case "K": return "#91a4c2"; // lightgray bluish
            case "L": return "#af70c2"; // magenta
            case "S": return "#d4071c"; // red
            default: return "transparent";
          }
        }

        // determine the geometry for each attribute shape in a male;
        // except for the slash these are all squares at each of the four corners of the overall square
        const tlsq = go.Geometry.parse("F M1 1 l19 0 0 19 -19 0z");
        const trsq = go.Geometry.parse("F M20 1 l19 0 0 19 -19 0z");
        const brsq = go.Geometry.parse("F M20 20 l19 0 0 19 -19 0z");
        const blsq = go.Geometry.parse("F M1 20 l19 0 0 19 -19 0z");
        const slash = go.Geometry.parse("F M38 0 L40 0 40 2 2 40 0 40 0 38z");
        function maleGeometry(a) {
          switch (a) {
            case "A": return tlsq;
            case "B": return tlsq;
            case "C": return tlsq;
            case "D": return trsq;
            case "E": return trsq;
            case "F": return trsq;
            case "G": return brsq;
            case "H": return brsq;
            case "I": return brsq;
            case "J": return blsq;
            case "K": return blsq;
            case "L": return blsq;
            case "S": return slash;
            default: return tlsq;
          }
        }

        // determine the geometry for each attribute shape in a female;
        // except for the slash these are all pie shapes at each of the four quadrants of the overall circle
        const tlarc = go.Geometry.parse("F M20 20 B 180 90 20 20 19 19 z");
        const trarc = go.Geometry.parse("F M20 20 B 270 90 20 20 19 19 z");
        const brarc = go.Geometry.parse("F M20 20 B 0 90 20 20 19 19 z");
        const blarc = go.Geometry.parse("F M20 20 B 90 90 20 20 19 19 z");
        function femaleGeometry(a) {
          switch (a) {
            case "A": return tlarc;
            case "B": return tlarc;
            case "C": return tlarc;
            case "D": return trarc;
            case "E": return trarc;
            case "F": return trarc;
            case "G": return brarc;
            case "H": return brarc;
            case "I": return brarc;
            case "J": return blarc;
            case "K": return blarc;
            case "L": return blarc;
            case "S": return slash;
            default: return tlarc;
          }
        }


        // two different node templates, one for each sex,
        // named by the category value in the node data object
        myDiagram.nodeTemplateMap.add("M",  // male
          $(go.Node, "Vertical",
            {
              locationSpot: go.Spot.Center, locationObjectName: "ICON",
              selectionObjectName: "ICON"
            },
            new go.Binding("opacity", "hide", h => h ? 0 : 1),
            new go.Binding("pickable", "hide", h => !h),
            $(go.Panel,
              { name: "ICON" },
              $(go.Shape, "Square",
                { width: 40, height: 40, strokeWidth: 2, fill: "white", stroke: "#919191", portId: "" }),
              $(go.Panel,
                { // for each attribute show a Shape at a particular place in the overall square
                  itemTemplate:
                    $(go.Panel,
                      $(go.Shape,
                        { stroke: null, strokeWidth: 0 },
                        new go.Binding("fill", "", attrFill),
                        new go.Binding("geometry", "", maleGeometry))
                    ),
                  margin: 1
                },
                new go.Binding("itemArray", "a")
              )
            ),
            $(go.TextBlock,
              { textAlign: "center", maxSize: new go.Size(80, NaN), background: "rgba(255,255,255,0.5)" },
              new go.Binding("text", "n"))
          ));

        myDiagram.nodeTemplateMap.add("F",  // female
          $(go.Node, "Vertical",
            {
              locationSpot: go.Spot.Center, locationObjectName: "ICON",
              selectionObjectName: "ICON"
            },
            new go.Binding("opacity", "hide", h => h ? 0 : 1),
            new go.Binding("pickable", "hide", h => !h),
            $(go.Panel,
              { name: "ICON" },
              $(go.Shape, "Circle",
                { width: 40, height: 40, strokeWidth: 2, fill: "white", stroke: "#a1a1a1", portId: "" }),
              $(go.Panel,
                { // for each attribute show a Shape at a particular place in the overall circle
                  itemTemplate:
                    $(go.Panel,
                      $(go.Shape,
                        { stroke: null, strokeWidth: 0 },
                        new go.Binding("fill", "", attrFill),
                        new go.Binding("geometry", "", femaleGeometry))
                    ),
                  margin: 1
                },
                new go.Binding("itemArray", "a")
              )
            ),
            $(go.TextBlock,
              { textAlign: "center", maxSize: new go.Size(80, NaN), background: "rgba(255,255,255,0.5)" },
              new go.Binding("text", "n"))
          ));

        // the representation of each label node -- nothing shows on a Marriage Link
        myDiagram.nodeTemplateMap.add("LinkLabel",
          $(go.Node,
            { selectable: false, width: 1, height: 1, fromEndSegmentLength: 20 }));

        myDiagram.linkTemplate =  // for parent-child relationships
          $(go.Link,
            {
              routing: go.Link.Orthogonal, corner: 10, curviness: 15,
              layerName: "Background", selectable: false
            },
            $(go.Shape, { stroke: "gray", strokeWidth: 2 })
          );

        myDiagram.linkTemplateMap.add("Marriage",  // for marriage relationships
          $(go.Link,
            // AvoidsNodes routing might be better when people have multiple marriages
            {
              routing: go.Link.AvoidsNodes, corner: 10,
              fromSpot: go.Spot.LeftRightSides, toSpot: go.Spot.LeftRightSides,
              selectable: false, isTreeLink: false, layerName: "Background"
            },
            $(go.Shape, { strokeWidth: 2.5, stroke: "#5d8cc1" /* blue */ })
          ));

        // n: name, s: sex, m: mother, f: father, ux: wife, vir: husband, a: attributes/markers

        setupDiagram(myDiagram, [
          { key: 0, n: "Aaron", s: "M", m: -10, f: -11, ux: 1, a: ["C", "F", "K"] },
          { key: 1, n: "Alice", s: "F", m: -12, f: -13, a: ["B", "H", "K"] },
          { key: 2, n: "Bob", s: "M", m: 1, f: 0, ux: 3, a: ["C", "H", "L"] },
          { key: 3, n: "Barbara", s: "F", a: ["C"] },
          { key: 4, n: "Bill", s: "M", m: 1, f: 0, ux: 5, a: ["E", "H"] },
          { key: 5, n: "Brooke", s: "F", a: ["B", "H", "L"] },
          { key: 6, n: "Claire", s: "F", m: 1, f: 0, a: ["C"] },
          { key: 7, n: "Carol", s: "F", m: 1, f: 0, a: ["C", "I"] },
          { key: 8, n: "Chloe", s: "F", m: 1, f: 0, vir: 9, a: ["E"] },
          { key: 9, n: "Chris", s: "M", a: ["B", "H"] },
          { key: 10, n: "Ellie", s: "F", m: 3, f: 2, a: ["E", "G"] },
          { key: 11, n: "Dan", s: "M", m: 3, f: 2, a: ["B", "J"] },
          { key: 12, n: "Elizabeth", s: "F", vir: 13, a: ["J"] },
          { key: 13, n: "David", s: "M", m: 5, f: 4, a: ["B", "H"] },
          { key: 14, n: "Emma", s: "F", m: 5, f: 4, a: ["E", "G"] },
          { key: 15, n: "Evan", s: "M", m: 8, f: 9, a: ["F", "H"] },
          { key: 16, n: "Ethan", s: "M", m: 8, f: 9, a: ["D", "K"] },
          { key: 17, n: "Eve", s: "F", vir: 16, a: ["B", "F", "L"] },
          { key: 18, n: "Emily", s: "F", m: 8, f: 9 },
          { key: 19, n: "Fred", s: "M", m: 17, f: 16, a: ["B"] },
          { key: 20, n: "Faith", s: "F", m: 17, f: 16, a: ["L"] },
          { key: 21, n: "Felicia", s: "F", m: 12, f: 13, a: ["H"] },
          { key: 22, n: "Frank", s: "M", m: 12, f: 13, a: ["B", "H"] },

          // "Aaron"'s ancestors
          { key: -10, n: "Paternal Grandfather", s: "M", m: -33, f: -32, ux: -11, a: ["A", "S"] },
          { key: -11, n: "Paternal Grandmother", s: "F", a: ["E", "S"] },
          { key: -32, n: "Paternal Great", s: "M", ux: -33, a: ["F", "H", "S"] },
          { key: -33, n: "Paternal Great", s: "F", a: ["S"] },
          { key: -40, n: "Great Uncle", s: "M", m: -33, f: -32, a: ["F", "H", "S"] },
          { key: -41, n: "Great Aunt", s: "F", m: -33, f: -32, a: ["B", "I", "S"] },
          { key: -20, n: "Uncle", s: "M", m: -11, f: -10, a: ["A", "S"] },

          // "Alice"'s ancestors
          { key: -12, n: "Maternal Grandfather", s: "M", ux: -13, a: ["D", "L", "S"] },
          { key: -13, n: "Maternal Grandmother", s: "F", m: -31, f: -30, a: ["H", "S"] },
          { key: -21, n: "Aunt", s: "F", m: -13, f: -12, a: ["C", "I"] },
          { key: -22, n: "Uncle", s: "M", ux: -21 },
          { key: -23, n: "Cousin", s: "M", m: -21, f: -22 },
          { key: -30, n: "Maternal Great", s: "M", ux: -31, a: ["D", "J", "S"] },
          { key: -31, n: "Maternal Great", s: "F", m: -50, f: -51, a: ["B", "H", "L", "S"] },
          { key: -42, n: "Great Uncle", s: "M", m: -30, f: -31, a: ["C", "J", "S"] },
          { key: -43, n: "Great Aunt", s: "F", m: -30, f: -31, a: ["E", "G", "S"] },
          { key: -50, n: "Maternal Great Great", s: "F", vir: -51, a: ["D", "I", "S"] },
          { key: -51, n: "Maternal Great Great", s: "M", a: ["B", "H", "S"] }
        ],
          4 /* focus on this person */);
      }


      // create and initialize the Diagram.model given an array of node data representing people
      function setupDiagram(diagram, array, focusId) {
        diagram.model =
          new go.GraphLinksModel(
            { // declare support for link label nodes
              linkLabelKeysProperty: "labelKeys",
              // this property determines which template is used
              nodeCategoryProperty: "s",
              // if a node data object is copied, copy its data.a Array
              copiesArrays: true,
              // create all of the nodes for people
              nodeDataArray: array
            });
        setupMarriages(diagram);
        setupParents(diagram);

        const node = diagram.findNodeForKey(focusId);
        if (node !== null) node.isSelected = true;
      }

      function findMarriage(diagram, a, b) {  // A and B are node keys
        const nodeA = diagram.findNodeForKey(a);
        const nodeB = diagram.findNodeForKey(b);
        if (nodeA !== null && nodeB !== null) {
          const it = nodeA.findLinksBetween(nodeB);  // in either direction
          while (it.next()) {
            const link = it.value;
            // Link.data.category === "Marriage" means it's a marriage relationship
            if (link.data !== null && link.data.category === "Marriage") return link;
          }
        }
        return null;
      }

      // now process the node data to determine marriages
      function setupMarriages(diagram) {
        const model = diagram.model;
        const nodeDataArray = model.nodeDataArray;
        for (let i = 0; i < nodeDataArray.length; i++) {
          const data = nodeDataArray[i];
          const key = data.key;
          let uxs = data.ux;
          if (uxs !== undefined) {
            if (typeof uxs === "number") uxs = [uxs];
            for (let j = 0; j < uxs.length; j++) {
              const wife = uxs[j];
              const wdata = model.findNodeDataForKey(wife);
              if (key === wife || !wdata || wdata.s !== "F") {
                console.log("cannot create Marriage relationship with self or unknown person " + wife);
                continue;
              }
              const link = findMarriage(diagram, key, wife);
              if (link === null) {
                // add a label node for the marriage link
                const mlab = { s: "LinkLabel" };
                model.addNodeData(mlab);
                // add the marriage link itself, also referring to the label node
                const mdata = { from: key, to: wife, labelKeys: [mlab.key], category: "Marriage" };
                model.addLinkData(mdata);
              }
            }
          }
          let virs = data.vir;
          if (virs !== undefined) {
            if (typeof virs === "number") virs = [virs];
            for (let j = 0; j < virs.length; j++) {
              const husband = virs[j];
              const hdata = model.findNodeDataForKey(husband);
              if (key === husband || !hdata || hdata.s !== "M") {
                console.log("cannot create Marriage relationship with self or unknown person " + husband);
                continue;
              }
              const link = findMarriage(diagram, key, husband);
              if (link === null) {
                // add a label node for the marriage link
                const mlab = { s: "LinkLabel" };
                model.addNodeData(mlab);
                // add the marriage link itself, also referring to the label node
                const mdata = { from: key, to: husband, labelKeys: [mlab.key], category: "Marriage" };
                model.addLinkData(mdata);
              }
            }
          }
        }
      }

      // process parent-child relationships once all marriages are known
      function setupParents(diagram) {
        const model = diagram.model;
        const nodeDataArray = model.nodeDataArray;
        for (let i = 0; i < nodeDataArray.length; i++) {
          const data = nodeDataArray[i];
          const key = data.key;
          const mother = data.m;
          const father = data.f;
          if (mother !== undefined && father !== undefined) {
            const link = findMarriage(diagram, mother, father);
            if (link === null) {
              // or warn no known mother or no known father or no known marriage between them
              console.log("unknown marriage: " + mother + " & " + father);
              continue;
            }
            const mdata = link.data;
            if (mdata.labelKeys === undefined || mdata.labelKeys[0] === undefined) continue;
            const mlabkey = mdata.labelKeys[0];
            const cdata = { from: mlabkey, to: key };
            myDiagram.model.addLinkData(cdata);
          }
        }
      }

      window.addEventListener('DOMContentLoaded', init);
    </script>

    <div id="sample">
      <div id="myDiagramDiv"
        style="background-color: rgb(248, 248, 248); border: 1px solid black; width: 100%; height: 600px; position: relative; -webkit-tap-highlight-color: rgba(255, 255, 255, 0);">
        <canvas tabindex="0" width="1720" height="1196"
          style="position: absolute; top: 0px; left: 0px; z-index: 2; user-select: none; touch-action: none; width: 860px; height: 598px;"></canvas>
        <div style="position: absolute; overflow: auto; width: 860px; height: 598px; z-index: 1;">
          <div style="position: absolute; width: 1px; height: 1px;"></div>
        </div>
      </div>
      <p>A <em>genogram</em> or <em>pedigree chart</em> is an extended family tree diagram that displays information
        about each person or each relationship.</p>
      <p>
        Note that the term "marriage" here does not refer to a legal or cultural kind of relationship,
        but simply one representing the female and male genetic sources for any children.
      </p>
      <p>
        There are functions that convert an attribute value into a brush color or Shape geometry,
        to be added to the Node representing the person.
      </p>
      <p>
        A custom <a href="../api/symbols/LayeredDigraphLayout.html" target="api">LayeredDigraphLayout</a> does the
        layout, assuming there is a central person whose mother and father
        each have their own ancestors. In this case we focus on "Bill", but any of the children of "Alice" and "Aaron"
        would work.
        The overridden <b>add</b> function allows husband/wife pairs to be represented by a single <a
          href="../api/symbols/LayeredDigraphVertex.html" target="api">LayeredDigraphVertex</a>.
      </p>
      <p>For a simpler family tree, see the <a href="familyTree.html">family tree sample</a>.</p>
      <p>
        The node data representing the people, processed by the <code>setupDiagram</code> function is below.
        The properties are:
      </p>
      <ul>
        <li><b>key</b>, the unique ID of the person</li>
        <li><b>n</b>, the person's name</li>
        <li><b>s</b>, the person's sex</li>
        <li><b>m</b>, the person's mother's key</li>
        <li><b>f</b>, the person's father's key</li>
        <li><b>ux</b>, the person's wife</li>
        <li><b>vir</b>, the person's husband</li>
        <li><b>a</b>, an Array of the attributes or markers that the person has</li>
      </ul>
      <p></p>
      <pre id="peopleData">[
  { key: 0, n: "Aaron", s: "M", m: -10, f: -11, ux: 1, a: ["C", "F", "K"] },
  { key: 1, n: "Alice", s: "F", m: -12, f: -13, a: ["B", "H", "K"] },
  { key: 2, n: "Bob", s: "M", m: 1, f: 0, ux: 3, a: ["C", "H", "L"] },
  { key: 3, n: "Barbara", s: "F", a: ["C"] },
  { key: 4, n: "Bill", s: "M", m: 1, f: 0, ux: 5, a: ["E", "H"] },
  { key: 5, n: "Brooke", s: "F", a: ["B", "H", "L"] },
  { key: 6, n: "Claire", s: "F", m: 1, f: 0, a: ["C"] },
  { key: 7, n: "Carol", s: "F", m: 1, f: 0, a: ["C", "I"] },
  { key: 8, n: "Chloe", s: "F", m: 1, f: 0, vir: 9, a: ["E"] },
  { key: 9, n: "Chris", s: "M", a: ["B", "H"] },
  { key: 10, n: "Ellie", s: "F", m: 3, f: 2, a: ["E", "G"] },
  { key: 11, n: "Dan", s: "M", m: 3, f: 2, a: ["B", "J"] },
  { key: 12, n: "Elizabeth", s: "F", vir: 13, a: ["J"] },
  { key: 13, n: "David", s: "M", m: 5, f: 4, a: ["B", "H"] },
  { key: 14, n: "Emma", s: "F", m: 5, f: 4, a: ["E", "G"] },
  { key: 15, n: "Evan", s: "M", m: 8, f: 9, a: ["F", "H"] },
  { key: 16, n: "Ethan", s: "M", m: 8, f: 9, a: ["D", "K"] },
  { key: 17, n: "Eve", s: "F", vir: 16, a: ["B", "F", "L"] },
  { key: 18, n: "Emily", s: "F", m: 8, f: 9 },
  { key: 19, n: "Fred", s: "M", m: 17, f: 16, a: ["B"] },
  { key: 20, n: "Faith", s: "F", m: 17, f: 16, a: ["L"] },
  { key: 21, n: "Felicia", s: "F", m: 12, f: 13, a: ["H"] },
  { key: 22, n: "Frank", s: "M", m: 12, f: 13, a: ["B", "H"] },

  // "Aaron"'s ancestors
  { key: -10, n: "Paternal Grandfather", s: "M", m: -33, f: -32, ux: -11, a: ["A", "S"] },
  { key: -11, n: "Paternal Grandmother", s: "F", a: ["E", "S"] },
  { key: -32, n: "Paternal Great", s: "M", ux: -33, a: ["F", "H", "S"] },
  { key: -33, n: "Paternal Great", s: "F", a: ["S"] },
  { key: -40, n: "Great Uncle", s: "M", m: -33, f: -32, a: ["F", "H", "S"] },
  { key: -41, n: "Great Aunt", s: "F", m: -33, f: -32, a: ["B", "I", "S"] },
  { key: -20, n: "Uncle", s: "M", m: -11, f: -10, a: ["A", "S"] },

  // "Alice"'s ancestors
  { key: -12, n: "Maternal Grandfather", s: "M", ux: -13, a: ["D", "L", "S"] },
  { key: -13, n: "Maternal Grandmother", s: "F", m: -31, f: -30, a: ["H", "S"] },
  { key: -21, n: "Aunt", s: "F", m: -13, f: -12, a: ["C", "I"] },
  { key: -22, n: "Uncle", s: "M", ux: -21 },
  { key: -23, n: "Cousin", s: "M", m: -21, f: -22 },
  { key: -30, n: "Maternal Great", s: "M", ux: -31, a: ["D", "J", "S"] },
  { key: -31, n: "Maternal Great", s: "F", m: -50, f: -51, a: ["B", "H", "L", "S"] },
  { key: -42, n: "Great Uncle", s: "M", m: -30, f: -31, a: ["C", "J", "S"] },
  { key: -43, n: "Great Aunt", s: "F", m: -30, f: -31, a: ["E", "G", "S"] },
  { key: -50, n: "Maternal Great Great", s: "F", vir: -51, a: ["D", "I", "S"] },
  { key: -51, n: "Maternal Great Great", s: "M", a: ["B", "H", "S"] }
]
  </pre>
      <p class="text-xs">GoJS version 2.3.13. Copyright 1998-2023 by Northwoods Software.</p>
    </div>
    <p><a href="https://github.com/NorthwoodsSoftware/GoJS/blob/master/samples/genogram.html" target="_blank">View this
        sample page's source on GitHub</a></p>
    <pre class=" language-js">
  <span class="token comment">// A custom layout that shows the two families related to a person's parents</span>
  <span class="token keyword">class</span> <span class="token class-name">GenogramLayout</span> <span class="token keyword">extends</span> <span class="token class-name">go<span class="token punctuation">.</span>LayeredDigraphLayout</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>alignOption <span class="token operator">=</span> go<span class="token punctuation">.</span>LayeredDigraphLayout<span class="token punctuation">.</span>AlignAll<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>initializeOption <span class="token operator">=</span> go<span class="token punctuation">.</span>LayeredDigraphLayout<span class="token punctuation">.</span>InitDepthFirstIn<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>spouseSpacing <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>  <span class="token comment">// minimum space between spouses</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>isRouting <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">makeNetwork</span><span class="token punctuation">(</span><span class="token parameter">coll</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// generate LayoutEdges for each parent-child Link</span>
      <span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createNetwork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>coll <span class="token keyword">instanceof</span> <span class="token class-name">go<span class="token punctuation">.</span>Diagram</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> coll<span class="token punctuation">.</span>nodes<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> coll<span class="token punctuation">.</span>links<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>coll <span class="token keyword">instanceof</span> <span class="token class-name">go<span class="token punctuation">.</span>Group</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> coll<span class="token punctuation">.</span>memberParts<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>coll<span class="token punctuation">.</span>iterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> coll<span class="token punctuation">.</span>iterator<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> net<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// internal method for creating LayeredDigraphNetwork where husband/wife pairs are represented</span>
    <span class="token comment">// by a single LayeredDigraphVertex corresponding to the label Node on the marriage Link</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">net<span class="token punctuation">,</span> coll<span class="token punctuation">,</span> nonmemberonly</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> horiz <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">==</span> <span class="token number">0.0</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">==</span> <span class="token number">180.0</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> multiSpousePeople <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// consider all Nodes in the given collection</span>
      <span class="token keyword">const</span> it <span class="token operator">=</span> coll<span class="token punctuation">.</span>iterator<span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> node <span class="token operator">=</span> it<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>node <span class="token keyword">instanceof</span> <span class="token class-name">go<span class="token punctuation">.</span>Node</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>node<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">.</span>isLayoutPositioned <span class="token operator">||</span> <span class="token operator">!</span>node<span class="token punctuation">.</span><span class="token function">isVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nonmemberonly <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>containingGroup <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token comment">// if it's an unmarried Node, or if it's a Link Label Node, create a LayoutVertex for it</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>isLinkLabel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// get marriage Link</span>
          <span class="token keyword">const</span> link <span class="token operator">=</span> node<span class="token punctuation">.</span>labeledLink<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>link<span class="token punctuation">.</span>category <span class="token operator">===</span> <span class="token string">"Marriage"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> spouseA <span class="token operator">=</span> link<span class="token punctuation">.</span>fromNode<span class="token punctuation">;</span>
            <span class="token keyword">const</span> spouseB <span class="token operator">=</span> link<span class="token punctuation">.</span>toNode<span class="token punctuation">;</span>
            <span class="token comment">// create vertex representing both husband and wife</span>
            <span class="token keyword">const</span> vertex <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">addNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// now define the vertex size to be big enough to hold both spouses</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>horiz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              vertex<span class="token punctuation">.</span>height <span class="token operator">=</span> spouseA<span class="token punctuation">.</span>actualBounds<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>spouseSpacing <span class="token operator">+</span> spouseB<span class="token punctuation">.</span>actualBounds<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
              vertex<span class="token punctuation">.</span>width <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>spouseA<span class="token punctuation">.</span>actualBounds<span class="token punctuation">.</span>width<span class="token punctuation">,</span> spouseB<span class="token punctuation">.</span>actualBounds<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>
              vertex<span class="token punctuation">.</span>focus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>vertex<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> spouseA<span class="token punctuation">.</span>actualBounds<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>spouseSpacing <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              vertex<span class="token punctuation">.</span>width <span class="token operator">=</span> spouseA<span class="token punctuation">.</span>actualBounds<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>spouseSpacing <span class="token operator">+</span> spouseB<span class="token punctuation">.</span>actualBounds<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
              vertex<span class="token punctuation">.</span>height <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>spouseA<span class="token punctuation">.</span>actualBounds<span class="token punctuation">.</span>height<span class="token punctuation">,</span> spouseB<span class="token punctuation">.</span>actualBounds<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
              vertex<span class="token punctuation">.</span>focus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>spouseA<span class="token punctuation">.</span>actualBounds<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>spouseSpacing <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> vertex<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// don't add a vertex for any married person!</span>
          <span class="token comment">// instead, code above adds label node for marriage link</span>
          <span class="token comment">// assume a marriage Link has a label Node</span>
          <span class="token keyword">let</span> marriages <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
          node<span class="token punctuation">.</span>linksConnected<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token parameter">l</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>category <span class="token operator">===</span> <span class="token string">"Marriage"</span><span class="token punctuation">)</span> marriages<span class="token operator">++</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>marriages <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            net<span class="token punctuation">.</span><span class="token function">addNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>marriages <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            multiSpousePeople<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// now do all Links</span>
      it<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> link <span class="token operator">=</span> it<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>link <span class="token keyword">instanceof</span> <span class="token class-name">go<span class="token punctuation">.</span>Link</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>link<span class="token punctuation">.</span>isLayoutPositioned <span class="token operator">||</span> <span class="token operator">!</span>link<span class="token punctuation">.</span><span class="token function">isVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nonmemberonly <span class="token operator">&amp;&amp;</span> link<span class="token punctuation">.</span>containingGroup <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token comment">// if it's a parent-child link, add a LayoutEdge for it</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>link<span class="token punctuation">.</span>category <span class="token operator">===</span> <span class="token string">""</span> <span class="token operator">&amp;&amp;</span> link<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> parent <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">findVertex</span><span class="token punctuation">(</span>link<span class="token punctuation">.</span>fromNode<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// should be a label node</span>
          <span class="token keyword">const</span> child <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">findVertex</span><span class="token punctuation">(</span>link<span class="token punctuation">.</span>toNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// an unmarried child</span>
            net<span class="token punctuation">.</span><span class="token function">linkVertexes</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> child<span class="token punctuation">,</span> link<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// a married child</span>
            link<span class="token punctuation">.</span>toNode<span class="token punctuation">.</span>linksConnected<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token parameter">l</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>category <span class="token operator">!==</span> <span class="token string">"Marriage"</span> <span class="token operator">||</span> <span class="token operator">!</span>l<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token comment">// if it has no label node, it's a parent-child link</span>
              <span class="token comment">// found the Marriage Link, now get its label Node</span>
              <span class="token keyword">const</span> mlab <span class="token operator">=</span> l<span class="token punctuation">.</span>labelNodes<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">// parent-child link should connect with the label node,</span>
              <span class="token comment">// so the LayoutEdge should connect with the LayoutVertex representing the label node</span>
              <span class="token keyword">const</span> mlabvert <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">findVertex</span><span class="token punctuation">(</span>mlab<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>mlabvert <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                net<span class="token punctuation">.</span><span class="token function">linkVertexes</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> mlabvert<span class="token punctuation">,</span> link<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">while</span> <span class="token punctuation">(</span>multiSpousePeople<span class="token punctuation">.</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// find all collections of people that are indirectly married to each other</span>
        <span class="token keyword">const</span> node <span class="token operator">=</span> multiSpousePeople<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> cohort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">extendCohort</span><span class="token punctuation">(</span>cohort<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// then encourage them all to be the same generation by connecting them all with a common vertex</span>
        <span class="token keyword">const</span> dummyvert <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">createVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        net<span class="token punctuation">.</span><span class="token function">addVertex</span><span class="token punctuation">(</span>dummyvert<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> marriages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cohort<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          n<span class="token punctuation">.</span>linksConnected<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token parameter">l</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            marriages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        marriages<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token parameter">link</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// find the vertex for the marriage link (i.e. for the label node)</span>
          <span class="token keyword">const</span> mlab <span class="token operator">=</span> link<span class="token punctuation">.</span>labelNodes<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> v <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">findVertex</span><span class="token punctuation">(</span>mlab<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            net<span class="token punctuation">.</span><span class="token function">linkVertexes</span><span class="token punctuation">(</span>dummyvert<span class="token punctuation">,</span> v<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// done with these people, now see if there are any other multiple-married people</span>
        multiSpousePeople<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span>cohort<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// collect all of the people indirectly married with a person</span>
    <span class="token function">extendCohort</span><span class="token punctuation">(</span><span class="token parameter">coll<span class="token punctuation">,</span> node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>coll<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      coll<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
      node<span class="token punctuation">.</span>linksConnected<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token parameter">l</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>category <span class="token operator">===</span> <span class="token string">"Marriage"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// if it's a marriage link, continue with both spouses</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">extendCohort</span><span class="token punctuation">(</span>coll<span class="token punctuation">,</span> l<span class="token punctuation">.</span>fromNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">extendCohort</span><span class="token punctuation">(</span>coll<span class="token punctuation">,</span> l<span class="token punctuation">.</span>toNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">assignLayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">assignLayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> horiz <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">==</span> <span class="token number">0.0</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">==</span> <span class="token number">180.0</span><span class="token punctuation">;</span>
      <span class="token comment">// for every vertex, record the maximum vertex width or height for the vertex's layer</span>
      <span class="token keyword">const</span> maxsizes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>network<span class="token punctuation">.</span>vertexes<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> lay <span class="token operator">=</span> v<span class="token punctuation">.</span>layer<span class="token punctuation">;</span>
        <span class="token keyword">let</span> max <span class="token operator">=</span> maxsizes<span class="token punctuation">[</span>lay<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>max <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> sz <span class="token operator">=</span> <span class="token punctuation">(</span>horiz <span class="token operator">?</span> v<span class="token punctuation">.</span>width <span class="token operator">:</span> v<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sz <span class="token operator">&gt;</span> max<span class="token punctuation">)</span> maxsizes<span class="token punctuation">[</span>lay<span class="token punctuation">]</span> <span class="token operator">=</span> sz<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// now make sure every vertex has the maximum width or height according to which layer it is in,</span>
      <span class="token comment">// and aligned on the left (if horizontal) or the top (if vertical)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>network<span class="token punctuation">.</span>vertexes<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> lay <span class="token operator">=</span> v<span class="token punctuation">.</span>layer<span class="token punctuation">;</span>
        <span class="token keyword">const</span> max <span class="token operator">=</span> maxsizes<span class="token punctuation">[</span>lay<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>horiz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          v<span class="token punctuation">.</span>focus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          v<span class="token punctuation">.</span>width <span class="token operator">=</span> max<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          v<span class="token punctuation">.</span>focus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          v<span class="token punctuation">.</span>height <span class="token operator">=</span> max<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// from now on, the LayeredDigraphLayout will think that the Node is bigger than it really is</span>
      <span class="token comment">// (other than the ones that are the widest or tallest in their respective layer).</span>
    <span class="token punctuation">}</span>

    <span class="token function">initializeIndices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initializeIndices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> vertical <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">===</span> <span class="token number">90</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">===</span> <span class="token number">270</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>network<span class="token punctuation">.</span>edges<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>fromVertex<span class="token punctuation">.</span>node <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>fromVertex<span class="token punctuation">.</span>node<span class="token punctuation">.</span>isLinkLabel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          e<span class="token punctuation">.</span>portFromPos <span class="token operator">=</span> vertical <span class="token operator">?</span> e<span class="token punctuation">.</span>fromVertex<span class="token punctuation">.</span>focusX <span class="token operator">:</span> e<span class="token punctuation">.</span>fromVertex<span class="token punctuation">.</span>focusY<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>toVertex<span class="token punctuation">.</span>node <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>toVertex<span class="token punctuation">.</span>node<span class="token punctuation">.</span>isLinkLabel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          e<span class="token punctuation">.</span>portToPos <span class="token operator">=</span> vertical <span class="token operator">?</span> e<span class="token punctuation">.</span>toVertex<span class="token punctuation">.</span>focusX <span class="token operator">:</span> e<span class="token punctuation">.</span>toVertex<span class="token punctuation">.</span>focusY<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">commitNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">commitNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// position regular nodes</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>network<span class="token punctuation">.</span>vertexes<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>node <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>v<span class="token punctuation">.</span>node<span class="token punctuation">.</span>isLinkLabel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          v<span class="token punctuation">.</span>node<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> horiz <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">==</span> <span class="token number">0.0</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">==</span> <span class="token number">180.0</span><span class="token punctuation">;</span>
      <span class="token comment">// position the spouses of each marriage vertex</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>network<span class="token punctuation">.</span>vertexes<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>node <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>v<span class="token punctuation">.</span>node<span class="token punctuation">.</span>isLinkLabel<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> labnode <span class="token operator">=</span> v<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
        <span class="token keyword">const</span> lablink <span class="token operator">=</span> labnode<span class="token punctuation">.</span>labeledLink<span class="token punctuation">;</span>
        <span class="token comment">// In case the spouses are not actually moved, we need to have the marriage link</span>
        <span class="token comment">// position the label node, because LayoutVertex.commit() was called above on these vertexes.</span>
        <span class="token comment">// Alternatively we could override LayoutVetex.commit to be a no-op for label node vertexes.</span>
        lablink<span class="token punctuation">.</span><span class="token function">invalidateRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> spouseA <span class="token operator">=</span> lablink<span class="token punctuation">.</span>fromNode<span class="token punctuation">;</span>
        <span class="token keyword">let</span> spouseB <span class="token operator">=</span> lablink<span class="token punctuation">.</span>toNode<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>spouseA<span class="token punctuation">.</span>opacity <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> spouseB<span class="token punctuation">.</span>opacity <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// prefer fathers on the left, mothers on the right</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>spouseA<span class="token punctuation">.</span>category <span class="token operator">===</span> <span class="token string">"F"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// sex is female</span>
            <span class="token keyword">const</span> temp <span class="token operator">=</span> spouseA<span class="token punctuation">;</span>
            spouseA <span class="token operator">=</span> spouseB<span class="token punctuation">;</span>
            spouseB <span class="token operator">=</span> temp<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// see if the parents are on the desired sides, to avoid a link crossing</span>
          <span class="token keyword">const</span> aParentsNode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findParentsMarriageLabelNode</span><span class="token punctuation">(</span>spouseA<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> bParentsNode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findParentsMarriageLabelNode</span><span class="token punctuation">(</span>spouseB<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>aParentsNode <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> bParentsNode <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
              <span class="token punctuation">(</span>horiz
                <span class="token operator">?</span> aParentsNode<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">&gt;</span> bParentsNode<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x
                <span class="token operator">:</span> aParentsNode<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">&gt;</span> bParentsNode<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// swap the spouses</span>
            <span class="token keyword">const</span> temp <span class="token operator">=</span> spouseA<span class="token punctuation">;</span>
            spouseA <span class="token operator">=</span> spouseB<span class="token punctuation">;</span>
            spouseB <span class="token operator">=</span> temp<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          spouseA<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>horiz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            spouseB<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y <span class="token operator">+</span> spouseA<span class="token punctuation">.</span>actualBounds<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>spouseSpacing<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            spouseB<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>x <span class="token operator">+</span> spouseA<span class="token punctuation">.</span>actualBounds<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>spouseSpacing<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>spouseA<span class="token punctuation">.</span>opacity <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> pos <span class="token operator">=</span> horiz
            <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> v<span class="token punctuation">.</span>centerY <span class="token operator">-</span> spouseB<span class="token punctuation">.</span>actualBounds<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>centerX <span class="token operator">-</span> spouseB<span class="token punctuation">.</span>actualBounds<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
          spouseB<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>horiz<span class="token punctuation">)</span> pos<span class="token punctuation">.</span>y<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token keyword">else</span> pos<span class="token punctuation">.</span>x<span class="token operator">++</span><span class="token punctuation">;</span>
          spouseA<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>spouseB<span class="token punctuation">.</span>opacity <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> pos <span class="token operator">=</span> horiz
            <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> v<span class="token punctuation">.</span>centerY <span class="token operator">-</span> spouseA<span class="token punctuation">.</span>actualBounds<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>centerX <span class="token operator">-</span> spouseA<span class="token punctuation">.</span>actualBounds<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
          spouseA<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>horiz<span class="token punctuation">)</span> pos<span class="token punctuation">.</span>y<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token keyword">else</span> pos<span class="token punctuation">.</span>x<span class="token operator">++</span><span class="token punctuation">;</span>
          spouseB<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        lablink<span class="token punctuation">.</span><span class="token function">ensureBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">findParentsMarriageLabelNode</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> it <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">findNodesInto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> n <span class="token operator">=</span> it<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>isLinkLabel<span class="token punctuation">)</span> <span class="token keyword">return</span> n<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token comment">// end GenogramLayout class</span>


    <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token comment">// Since 2.2 you can also author concise templates with method chaining instead of GraphObject.make</span>
      <span class="token comment">// For details, see https://gojs.net/latest/intro/buildingObjects.html</span>
      <span class="token keyword">const</span> $ <span class="token operator">=</span> go<span class="token punctuation">.</span>GraphObject<span class="token punctuation">.</span>make<span class="token punctuation">;</span>

      myDiagram <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Diagram</span><span class="token punctuation">(</span><span class="token string">"myDiagramDiv"</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token string">"animationManager.isEnabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            initialAutoScale<span class="token operator">:</span> go<span class="token punctuation">.</span>Diagram<span class="token punctuation">.</span>Uniform<span class="token punctuation">,</span>
            <span class="token string">"undoManager.isEnabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            maxSelectionCount<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token comment">// when a node is selected, draw a big yellow circle behind it</span>
            nodeSelectionAdornmentTemplate<span class="token operator">:</span>
              <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Adornment<span class="token punctuation">,</span> <span class="token string">"Auto"</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span> layerName<span class="token operator">:</span> <span class="token string">"Grid"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// the predefined layer that is behind everything else</span>
                <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token string">"Circle"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> fill<span class="token operator">:</span> <span class="token string">"#c1cee3"</span><span class="token punctuation">,</span> stroke<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Placeholder<span class="token punctuation">,</span> <span class="token punctuation">{</span> margin<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            layout<span class="token operator">:</span>  <span class="token comment">// use a custom layout, defined above</span>
              <span class="token function">$</span><span class="token punctuation">(</span>GenogramLayout<span class="token punctuation">,</span> <span class="token punctuation">{</span> direction<span class="token operator">:</span> <span class="token number">90</span><span class="token punctuation">,</span> layerSpacing<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> columnSpacing<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// determine the color for each attribute shape</span>
      <span class="token keyword">function</span> <span class="token function">attrFill</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">case</span> <span class="token string">"A"</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">"#00af54"</span><span class="token punctuation">;</span> <span class="token comment">// green</span>
          <span class="token keyword">case</span> <span class="token string">"B"</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">"#f27935"</span><span class="token punctuation">;</span> <span class="token comment">// orange</span>
          <span class="token keyword">case</span> <span class="token string">"C"</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">"#d4071c"</span><span class="token punctuation">;</span> <span class="token comment">// red</span>
          <span class="token keyword">case</span> <span class="token string">"D"</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">"#70bdc2"</span><span class="token punctuation">;</span> <span class="token comment">// cyan</span>
          <span class="token keyword">case</span> <span class="token string">"E"</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">"#fcf384"</span><span class="token punctuation">;</span> <span class="token comment">// gold</span>
          <span class="token keyword">case</span> <span class="token string">"F"</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">"#e69aaf"</span><span class="token punctuation">;</span> <span class="token comment">// pink</span>
          <span class="token keyword">case</span> <span class="token string">"G"</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">"#08488f"</span><span class="token punctuation">;</span> <span class="token comment">// blue</span>
          <span class="token keyword">case</span> <span class="token string">"H"</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">"#866310"</span><span class="token punctuation">;</span> <span class="token comment">// brown</span>
          <span class="token keyword">case</span> <span class="token string">"I"</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">"#9270c2"</span><span class="token punctuation">;</span> <span class="token comment">// purple</span>
          <span class="token keyword">case</span> <span class="token string">"J"</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">"#a3cf62"</span><span class="token punctuation">;</span> <span class="token comment">// chartreuse</span>
          <span class="token keyword">case</span> <span class="token string">"K"</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">"#91a4c2"</span><span class="token punctuation">;</span> <span class="token comment">// lightgray bluish</span>
          <span class="token keyword">case</span> <span class="token string">"L"</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">"#af70c2"</span><span class="token punctuation">;</span> <span class="token comment">// magenta</span>
          <span class="token keyword">case</span> <span class="token string">"S"</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">"#d4071c"</span><span class="token punctuation">;</span> <span class="token comment">// red</span>
          <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">"transparent"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// determine the geometry for each attribute shape in a male;</span>
      <span class="token comment">// except for the slash these are all squares at each of the four corners of the overall square</span>
      <span class="token keyword">const</span> tlsq <span class="token operator">=</span> go<span class="token punctuation">.</span>Geometry<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"F M1 1 l19 0 0 19 -19 0z"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> trsq <span class="token operator">=</span> go<span class="token punctuation">.</span>Geometry<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"F M20 1 l19 0 0 19 -19 0z"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> brsq <span class="token operator">=</span> go<span class="token punctuation">.</span>Geometry<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"F M20 20 l19 0 0 19 -19 0z"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> blsq <span class="token operator">=</span> go<span class="token punctuation">.</span>Geometry<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"F M1 20 l19 0 0 19 -19 0z"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> slash <span class="token operator">=</span> go<span class="token punctuation">.</span>Geometry<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"F M38 0 L40 0 40 2 2 40 0 40 0 38z"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">function</span> <span class="token function">maleGeometry</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">case</span> <span class="token string">"A"</span><span class="token operator">:</span> <span class="token keyword">return</span> tlsq<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"B"</span><span class="token operator">:</span> <span class="token keyword">return</span> tlsq<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"C"</span><span class="token operator">:</span> <span class="token keyword">return</span> tlsq<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"D"</span><span class="token operator">:</span> <span class="token keyword">return</span> trsq<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"E"</span><span class="token operator">:</span> <span class="token keyword">return</span> trsq<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"F"</span><span class="token operator">:</span> <span class="token keyword">return</span> trsq<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"G"</span><span class="token operator">:</span> <span class="token keyword">return</span> brsq<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"H"</span><span class="token operator">:</span> <span class="token keyword">return</span> brsq<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"I"</span><span class="token operator">:</span> <span class="token keyword">return</span> brsq<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"J"</span><span class="token operator">:</span> <span class="token keyword">return</span> blsq<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"K"</span><span class="token operator">:</span> <span class="token keyword">return</span> blsq<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"L"</span><span class="token operator">:</span> <span class="token keyword">return</span> blsq<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"S"</span><span class="token operator">:</span> <span class="token keyword">return</span> slash<span class="token punctuation">;</span>
          <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">return</span> tlsq<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// determine the geometry for each attribute shape in a female;</span>
      <span class="token comment">// except for the slash these are all pie shapes at each of the four quadrants of the overall circle</span>
      <span class="token keyword">const</span> tlarc <span class="token operator">=</span> go<span class="token punctuation">.</span>Geometry<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"F M20 20 B 180 90 20 20 19 19 z"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> trarc <span class="token operator">=</span> go<span class="token punctuation">.</span>Geometry<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"F M20 20 B 270 90 20 20 19 19 z"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> brarc <span class="token operator">=</span> go<span class="token punctuation">.</span>Geometry<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"F M20 20 B 0 90 20 20 19 19 z"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> blarc <span class="token operator">=</span> go<span class="token punctuation">.</span>Geometry<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"F M20 20 B 90 90 20 20 19 19 z"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">function</span> <span class="token function">femaleGeometry</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">case</span> <span class="token string">"A"</span><span class="token operator">:</span> <span class="token keyword">return</span> tlarc<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"B"</span><span class="token operator">:</span> <span class="token keyword">return</span> tlarc<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"C"</span><span class="token operator">:</span> <span class="token keyword">return</span> tlarc<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"D"</span><span class="token operator">:</span> <span class="token keyword">return</span> trarc<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"E"</span><span class="token operator">:</span> <span class="token keyword">return</span> trarc<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"F"</span><span class="token operator">:</span> <span class="token keyword">return</span> trarc<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"G"</span><span class="token operator">:</span> <span class="token keyword">return</span> brarc<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"H"</span><span class="token operator">:</span> <span class="token keyword">return</span> brarc<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"I"</span><span class="token operator">:</span> <span class="token keyword">return</span> brarc<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"J"</span><span class="token operator">:</span> <span class="token keyword">return</span> blarc<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"K"</span><span class="token operator">:</span> <span class="token keyword">return</span> blarc<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"L"</span><span class="token operator">:</span> <span class="token keyword">return</span> blarc<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">"S"</span><span class="token operator">:</span> <span class="token keyword">return</span> slash<span class="token punctuation">;</span>
          <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">return</span> tlarc<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>


      <span class="token comment">// two different node templates, one for each sex,</span>
      <span class="token comment">// named by the category value in the node data object</span>
      myDiagram<span class="token punctuation">.</span>nodeTemplateMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"M"</span><span class="token punctuation">,</span>  <span class="token comment">// male</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Node<span class="token punctuation">,</span> <span class="token string">"Vertical"</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> locationSpot<span class="token operator">:</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Center<span class="token punctuation">,</span> locationObjectName<span class="token operator">:</span> <span class="token string">"ICON"</span><span class="token punctuation">,</span>
            selectionObjectName<span class="token operator">:</span> <span class="token string">"ICON"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"opacity"</span><span class="token punctuation">,</span> <span class="token string">"hide"</span><span class="token punctuation">,</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> h <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"pickable"</span><span class="token punctuation">,</span> <span class="token string">"hide"</span><span class="token punctuation">,</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>h<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Panel<span class="token punctuation">,</span>
            <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"ICON"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token string">"Square"</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span> width<span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span> strokeWidth<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> fill<span class="token operator">:</span> <span class="token string">"white"</span><span class="token punctuation">,</span> stroke<span class="token operator">:</span> <span class="token string">"#919191"</span><span class="token punctuation">,</span> portId<span class="token operator">:</span> <span class="token string">""</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Panel<span class="token punctuation">,</span>
              <span class="token punctuation">{</span> <span class="token comment">// for each attribute show a Shape at a particular place in the overall square</span>
                itemTemplate<span class="token operator">:</span>
                  <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Panel<span class="token punctuation">,</span>
                    <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span>
                      <span class="token punctuation">{</span> stroke<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> strokeWidth<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                      <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"fill"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> attrFill<span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"geometry"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> maleGeometry<span class="token punctuation">)</span><span class="token punctuation">)</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                margin<span class="token operator">:</span> <span class="token number">1</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"itemArray"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>TextBlock<span class="token punctuation">,</span>
            <span class="token punctuation">{</span> textAlign<span class="token operator">:</span> <span class="token string">"center"</span><span class="token punctuation">,</span> maxSize<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">,</span> background<span class="token operator">:</span> <span class="token string">"rgba(255,255,255,0.5)"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token string">"n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      myDiagram<span class="token punctuation">.</span>nodeTemplateMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"F"</span><span class="token punctuation">,</span>  <span class="token comment">// female</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Node<span class="token punctuation">,</span> <span class="token string">"Vertical"</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> locationSpot<span class="token operator">:</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Center<span class="token punctuation">,</span> locationObjectName<span class="token operator">:</span> <span class="token string">"ICON"</span><span class="token punctuation">,</span>
            selectionObjectName<span class="token operator">:</span> <span class="token string">"ICON"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"opacity"</span><span class="token punctuation">,</span> <span class="token string">"hide"</span><span class="token punctuation">,</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> h <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"pickable"</span><span class="token punctuation">,</span> <span class="token string">"hide"</span><span class="token punctuation">,</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>h<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Panel<span class="token punctuation">,</span>
            <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"ICON"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token string">"Circle"</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span> width<span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span> strokeWidth<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> fill<span class="token operator">:</span> <span class="token string">"white"</span><span class="token punctuation">,</span> stroke<span class="token operator">:</span> <span class="token string">"#a1a1a1"</span><span class="token punctuation">,</span> portId<span class="token operator">:</span> <span class="token string">""</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Panel<span class="token punctuation">,</span>
              <span class="token punctuation">{</span> <span class="token comment">// for each attribute show a Shape at a particular place in the overall circle</span>
                itemTemplate<span class="token operator">:</span>
                  <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Panel<span class="token punctuation">,</span>
                    <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span>
                      <span class="token punctuation">{</span> stroke<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> strokeWidth<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                      <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"fill"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> attrFill<span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"geometry"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> femaleGeometry<span class="token punctuation">)</span><span class="token punctuation">)</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                margin<span class="token operator">:</span> <span class="token number">1</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"itemArray"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>TextBlock<span class="token punctuation">,</span>
            <span class="token punctuation">{</span> textAlign<span class="token operator">:</span> <span class="token string">"center"</span><span class="token punctuation">,</span> maxSize<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">,</span> background<span class="token operator">:</span> <span class="token string">"rgba(255,255,255,0.5)"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token string">"n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// the representation of each label node -- nothing shows on a Marriage Link</span>
      myDiagram<span class="token punctuation">.</span>nodeTemplateMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"LinkLabel"</span><span class="token punctuation">,</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Node<span class="token punctuation">,</span>
          <span class="token punctuation">{</span> selectable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> width<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> fromEndSegmentLength<span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      myDiagram<span class="token punctuation">.</span>linkTemplate <span class="token operator">=</span>  <span class="token comment">// for parent-child relationships</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Link<span class="token punctuation">,</span>
          <span class="token punctuation">{</span> routing<span class="token operator">:</span> go<span class="token punctuation">.</span>Link<span class="token punctuation">.</span>Orthogonal<span class="token punctuation">,</span> corner<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> curviness<span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span> 
            layerName<span class="token operator">:</span> <span class="token string">"Background"</span><span class="token punctuation">,</span> selectable<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token punctuation">{</span> stroke<span class="token operator">:</span> <span class="token string">"gray"</span><span class="token punctuation">,</span> strokeWidth<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

      myDiagram<span class="token punctuation">.</span>linkTemplateMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Marriage"</span><span class="token punctuation">,</span>  <span class="token comment">// for marriage relationships</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Link<span class="token punctuation">,</span>
          <span class="token comment">// AvoidsNodes routing might be better when people have multiple marriages</span>
          <span class="token punctuation">{</span> routing<span class="token operator">:</span> go<span class="token punctuation">.</span>Link<span class="token punctuation">.</span>AvoidsNodes<span class="token punctuation">,</span> corner<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            fromSpot<span class="token operator">:</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>LeftRightSides<span class="token punctuation">,</span> toSpot<span class="token operator">:</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>LeftRightSides<span class="token punctuation">,</span>
            selectable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> isTreeLink<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> layerName<span class="token operator">:</span> <span class="token string">"Background"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token punctuation">{</span> strokeWidth<span class="token operator">:</span> <span class="token number">2.5</span><span class="token punctuation">,</span> stroke<span class="token operator">:</span> <span class="token string">"#5d8cc1"</span> <span class="token comment">/* blue */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// n: name, s: sex, m: mother, f: father, ux: wife, vir: husband, a: attributes/markers</span>

      <span class="token function">setupDiagram</span><span class="token punctuation">(</span>myDiagram<span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Aaron"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span> ux<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"F"</span><span class="token punctuation">,</span> <span class="token string">"K"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"H"</span><span class="token punctuation">,</span> <span class="token string">"K"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> ux<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"H"</span><span class="token punctuation">,</span> <span class="token string">"L"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Barbara"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Bill"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> ux<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"E"</span><span class="token punctuation">,</span> <span class="token string">"H"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Brooke"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"H"</span><span class="token punctuation">,</span> <span class="token string">"L"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Claire"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Carol"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"I"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Chloe"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> vir<span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"E"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Chris"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"H"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Ellie"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"E"</span><span class="token punctuation">,</span> <span class="token string">"G"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Dan"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"J"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Elizabeth"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> vir<span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"J"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"David"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"H"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Emma"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"E"</span><span class="token punctuation">,</span> <span class="token string">"G"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Evan"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"F"</span><span class="token punctuation">,</span> <span class="token string">"H"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Ethan"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"D"</span><span class="token punctuation">,</span> <span class="token string">"K"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">17</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Eve"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> vir<span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"F"</span><span class="token punctuation">,</span> <span class="token string">"L"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Emily"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token number">9</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Fred"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token number">17</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"B"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Faith"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token number">17</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"L"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Felicia"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"H"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Frank"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"H"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token comment">// "Aaron"'s ancestors</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Paternal Grandfather"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">33</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">32</span><span class="token punctuation">,</span> ux<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token string">"S"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Paternal Grandmother"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"E"</span><span class="token punctuation">,</span> <span class="token string">"S"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">32</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Paternal Great"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> ux<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">33</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"F"</span><span class="token punctuation">,</span> <span class="token string">"H"</span><span class="token punctuation">,</span> <span class="token string">"S"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">33</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Paternal Great"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"S"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Great Uncle"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">33</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">32</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"F"</span><span class="token punctuation">,</span> <span class="token string">"H"</span><span class="token punctuation">,</span> <span class="token string">"S"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">41</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Great Aunt"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">33</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">32</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"I"</span><span class="token punctuation">,</span> <span class="token string">"S"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Uncle"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token string">"S"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token comment">// "Alice"'s ancestors</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Maternal Grandfather"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> ux<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"D"</span><span class="token punctuation">,</span> <span class="token string">"L"</span><span class="token punctuation">,</span> <span class="token string">"S"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Maternal Grandmother"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">31</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">30</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"H"</span><span class="token punctuation">,</span> <span class="token string">"S"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Aunt"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"I"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">22</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Uncle"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> ux<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">21</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">23</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Cousin"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">22</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">30</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Maternal Great"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> ux<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">31</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"D"</span><span class="token punctuation">,</span> <span class="token string">"J"</span><span class="token punctuation">,</span> <span class="token string">"S"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">31</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Maternal Great"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">51</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"H"</span><span class="token punctuation">,</span> <span class="token string">"L"</span><span class="token punctuation">,</span> <span class="token string">"S"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">42</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Great Uncle"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">30</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">31</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"J"</span><span class="token punctuation">,</span> <span class="token string">"S"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">43</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Great Aunt"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">30</span><span class="token punctuation">,</span> f<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">31</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"E"</span><span class="token punctuation">,</span> <span class="token string">"G"</span><span class="token punctuation">,</span> <span class="token string">"S"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Maternal Great Great"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> vir<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">51</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"D"</span><span class="token punctuation">,</span> <span class="token string">"I"</span><span class="token punctuation">,</span> <span class="token string">"S"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">51</span><span class="token punctuation">,</span> n<span class="token operator">:</span> <span class="token string">"Maternal Great Great"</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"H"</span><span class="token punctuation">,</span> <span class="token string">"S"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token number">4</span> <span class="token comment">/* focus on this person */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// create and initialize the Diagram.model given an array of node data representing people</span>
    <span class="token keyword">function</span> <span class="token function">setupDiagram</span><span class="token punctuation">(</span><span class="token parameter">diagram<span class="token punctuation">,</span> array<span class="token punctuation">,</span> focusId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      diagram<span class="token punctuation">.</span>model <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>GraphLinksModel</span><span class="token punctuation">(</span>
          <span class="token punctuation">{</span> <span class="token comment">// declare support for link label nodes</span>
            linkLabelKeysProperty<span class="token operator">:</span> <span class="token string">"labelKeys"</span><span class="token punctuation">,</span>
            <span class="token comment">// this property determines which template is used</span>
            nodeCategoryProperty<span class="token operator">:</span> <span class="token string">"s"</span><span class="token punctuation">,</span>
            <span class="token comment">// if a node data object is copied, copy its data.a Array</span>
            copiesArrays<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token comment">// create all of the nodes for people</span>
            nodeDataArray<span class="token operator">:</span> array
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setupMarriages</span><span class="token punctuation">(</span>diagram<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setupParents</span><span class="token punctuation">(</span>diagram<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> node <span class="token operator">=</span> diagram<span class="token punctuation">.</span><span class="token function">findNodeForKey</span><span class="token punctuation">(</span>focusId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> node<span class="token punctuation">.</span>isSelected <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">findMarriage</span><span class="token punctuation">(</span><span class="token parameter">diagram<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// A and B are node keys</span>
      <span class="token keyword">const</span> nodeA <span class="token operator">=</span> diagram<span class="token punctuation">.</span><span class="token function">findNodeForKey</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> nodeB <span class="token operator">=</span> diagram<span class="token punctuation">.</span><span class="token function">findNodeForKey</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>nodeA <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> nodeB <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> it <span class="token operator">=</span> nodeA<span class="token punctuation">.</span><span class="token function">findLinksBetween</span><span class="token punctuation">(</span>nodeB<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// in either direction</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> link <span class="token operator">=</span> it<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
          <span class="token comment">// Link.data.category === "Marriage" means it's a marriage relationship</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>link<span class="token punctuation">.</span>data <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> link<span class="token punctuation">.</span>data<span class="token punctuation">.</span>category <span class="token operator">===</span> <span class="token string">"Marriage"</span><span class="token punctuation">)</span> <span class="token keyword">return</span> link<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// now process the node data to determine marriages</span>
    <span class="token keyword">function</span> <span class="token function">setupMarriages</span><span class="token punctuation">(</span><span class="token parameter">diagram</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> model <span class="token operator">=</span> diagram<span class="token punctuation">.</span>model<span class="token punctuation">;</span>
      <span class="token keyword">const</span> nodeDataArray <span class="token operator">=</span> model<span class="token punctuation">.</span>nodeDataArray<span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nodeDataArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> nodeDataArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> key <span class="token operator">=</span> data<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
        <span class="token keyword">let</span> uxs <span class="token operator">=</span> data<span class="token punctuation">.</span>ux<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>uxs <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> uxs <span class="token operator">===</span> <span class="token string">"number"</span><span class="token punctuation">)</span> uxs <span class="token operator">=</span> <span class="token punctuation">[</span>uxs<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> uxs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> wife <span class="token operator">=</span> uxs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> wdata <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">findNodeDataForKey</span><span class="token punctuation">(</span>wife<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> wife <span class="token operator">||</span> <span class="token operator">!</span>wdata <span class="token operator">||</span> wdata<span class="token punctuation">.</span>s <span class="token operator">!==</span> <span class="token string">"F"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"cannot create Marriage relationship with self or unknown person "</span> <span class="token operator">+</span> wife<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">const</span> link <span class="token operator">=</span> <span class="token function">findMarriage</span><span class="token punctuation">(</span>diagram<span class="token punctuation">,</span> key<span class="token punctuation">,</span> wife<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>link <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// add a label node for the marriage link</span>
              <span class="token keyword">const</span> mlab <span class="token operator">=</span> <span class="token punctuation">{</span> s<span class="token operator">:</span> <span class="token string">"LinkLabel"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
              model<span class="token punctuation">.</span><span class="token function">addNodeData</span><span class="token punctuation">(</span>mlab<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">// add the marriage link itself, also referring to the label node</span>
              <span class="token keyword">const</span> mdata <span class="token operator">=</span> <span class="token punctuation">{</span> from<span class="token operator">:</span> key<span class="token punctuation">,</span> to<span class="token operator">:</span> wife<span class="token punctuation">,</span> labelKeys<span class="token operator">:</span> <span class="token punctuation">[</span>mlab<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> category<span class="token operator">:</span> <span class="token string">"Marriage"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
              model<span class="token punctuation">.</span><span class="token function">addLinkData</span><span class="token punctuation">(</span>mdata<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> virs <span class="token operator">=</span> data<span class="token punctuation">.</span>vir<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>virs <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> virs <span class="token operator">===</span> <span class="token string">"number"</span><span class="token punctuation">)</span> virs <span class="token operator">=</span> <span class="token punctuation">[</span>virs<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> virs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> husband <span class="token operator">=</span> virs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> hdata <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">findNodeDataForKey</span><span class="token punctuation">(</span>husband<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> husband <span class="token operator">||</span> <span class="token operator">!</span>hdata <span class="token operator">||</span> hdata<span class="token punctuation">.</span>s <span class="token operator">!==</span> <span class="token string">"M"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"cannot create Marriage relationship with self or unknown person "</span> <span class="token operator">+</span> husband<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">const</span> link <span class="token operator">=</span> <span class="token function">findMarriage</span><span class="token punctuation">(</span>diagram<span class="token punctuation">,</span> key<span class="token punctuation">,</span> husband<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>link <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// add a label node for the marriage link</span>
              <span class="token keyword">const</span> mlab <span class="token operator">=</span> <span class="token punctuation">{</span> s<span class="token operator">:</span> <span class="token string">"LinkLabel"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
              model<span class="token punctuation">.</span><span class="token function">addNodeData</span><span class="token punctuation">(</span>mlab<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">// add the marriage link itself, also referring to the label node</span>
              <span class="token keyword">const</span> mdata <span class="token operator">=</span> <span class="token punctuation">{</span> from<span class="token operator">:</span> key<span class="token punctuation">,</span> to<span class="token operator">:</span> husband<span class="token punctuation">,</span> labelKeys<span class="token operator">:</span> <span class="token punctuation">[</span>mlab<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> category<span class="token operator">:</span> <span class="token string">"Marriage"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
              model<span class="token punctuation">.</span><span class="token function">addLinkData</span><span class="token punctuation">(</span>mdata<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// process parent-child relationships once all marriages are known</span>
    <span class="token keyword">function</span> <span class="token function">setupParents</span><span class="token punctuation">(</span><span class="token parameter">diagram</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> model <span class="token operator">=</span> diagram<span class="token punctuation">.</span>model<span class="token punctuation">;</span>
      <span class="token keyword">const</span> nodeDataArray <span class="token operator">=</span> model<span class="token punctuation">.</span>nodeDataArray<span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nodeDataArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> nodeDataArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> key <span class="token operator">=</span> data<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
        <span class="token keyword">const</span> mother <span class="token operator">=</span> data<span class="token punctuation">.</span>m<span class="token punctuation">;</span>
        <span class="token keyword">const</span> father <span class="token operator">=</span> data<span class="token punctuation">.</span>f<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mother <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> father <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> link <span class="token operator">=</span> <span class="token function">findMarriage</span><span class="token punctuation">(</span>diagram<span class="token punctuation">,</span> mother<span class="token punctuation">,</span> father<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>link <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// or warn no known mother or no known father or no known marriage between them</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"unknown marriage: "</span> <span class="token operator">+</span> mother <span class="token operator">+</span> <span class="token string">" &amp; "</span> <span class="token operator">+</span> father<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">const</span> mdata <span class="token operator">=</span> link<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>mdata<span class="token punctuation">.</span>labelKeys <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> mdata<span class="token punctuation">.</span>labelKeys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> mlabkey <span class="token operator">=</span> mdata<span class="token punctuation">.</span>labelKeys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> cdata <span class="token operator">=</span> <span class="token punctuation">{</span> from<span class="token operator">:</span> mlabkey<span class="token punctuation">,</span> to<span class="token operator">:</span> key <span class="token punctuation">}</span><span class="token punctuation">;</span>
          myDiagram<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">addLinkData</span><span class="token punctuation">(</span>cdata<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span>
  </pre>
  </div>
</body>

</html>